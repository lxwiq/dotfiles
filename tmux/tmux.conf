# Ultimate Tmux Configuration with Catppuccin Macchiato Theme
# Optimized for visual appeal and functionality

# =====================================
# ===           General            ===
# =====================================

# Set terminal to support 256 colors and true color
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",*256col*:Tc,alacritty:RGB"

# Change prefix key to Ctrl+a
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# Start window and pane numbering at 1
set -g base-index 1
setw -g pane-base-index 1

# Automatically renumber windows when one is closed
set -g renumber-windows on

# Increase scrollback buffer size
set -g history-limit 50000

# Enable mouse support
set -g mouse on

# Set escape time to 10ms for faster command sequences
set -sg escape-time 10

# Focus events enabled for terminals that support them
set -g focus-events on

# Super useful when using "grouped sessions" and multi-monitor setup
setw -g aggressive-resize on

# Reload tmux config with prefix + r
bind r source-file ~/.config/tmux/tmux.conf \; display "Config reloaded!"

# Add a clear screen binding (Prefix + Ctrl+L)
bind C-l send-keys 'C-l'

# =====================================
# ===           Windows            ===
# =====================================

# Create new window with current path
bind c new-window -c "#{pane_current_path}"

# Split panes using v and h with current path
bind v split-window -h -c "#{pane_current_path}"  # vertical split (left/right)
bind h split-window -v -c "#{pane_current_path}"  # horizontal split (top/bottom)
unbind '"'
unbind %

# Quick window selection
bind -r C-h select-window -t :-
bind -r C-l select-window -t :+

# =====================================
# ===            Panes             ===
# =====================================

# Smart pane switching with awareness of Vim splits
# See: https://github.com/christoomey/vim-tmux-navigator
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
bind -n 'C-h' if-shell "$is_vim" 'send-keys C-h'  'select-pane -L'
bind -n 'C-j' if-shell "$is_vim" 'send-keys C-j'  'select-pane -D'
bind -n 'C-k' if-shell "$is_vim" 'send-keys C-k'  'select-pane -U'
bind -n 'C-l' if-shell "$is_vim" 'send-keys C-l'  'select-pane -R'

# Resize panes with Prefix + arrow keys
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Toggle synchronized panes
bind C-x setw synchronize-panes \; display "Sync #{?synchronize-panes,ON,OFF}"

# Swap panes
bind > swap-pane -D
bind < swap-pane -U

# =====================================
# ===           Sessions           ===
# =====================================

# Easy session switching with Prefix + j/k
bind -r j switch-client -n
bind -r k switch-client -p

# Session management
bind C-s new-session
bind C-f command-prompt -p find-session 'switch-client -t %%'
bind X confirm-before -p "Kill session #S? (y/n)" "run-shell 'tmux switch-client -n \\\; kill-session -t \"\$(tmux display-message -p \"#S\")\"'"

# =====================================
# ===            Modes             ===
# =====================================

# Enable vi mode
setw -g mode-keys vi

# Copy mode using 'v' and 'y' like in vim
bind-key -T copy-mode-vi v send -X begin-selection
bind-key -T copy-mode-vi C-v send -X rectangle-toggle
bind-key -T copy-mode-vi y send -X copy-selection-and-cancel

# Use system clipboard
if-shell "uname | grep -q Darwin" {
    bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"
    bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "pbcopy"
    bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "pbcopy"
}

# =====================================
# ===     Custom Status Bar        ===
# =====================================

# Status bar design with explicit icons
set -g status-position top
set -g status-justify left
set -g status-style "bg=#24273a,fg=#cad3f5"
set -g status-left-length 100
set -g status-right-length 100

# Status left with explicit icons
set -g status-left "#[fg=#24273a,bg=#8aadf4,bold] #S #[fg=#8aadf4,bg=#24273a]"

# Status right with explicit icons
set -g status-right "#[fg=#363a4f,bg=#24273a]#[fg=#cad3f5,bg=#363a4f] %Y-%m-%d #[fg=#8aadf4,bg=#363a4f]#[fg=#24273a,bg=#8aadf4,bold] %H:%M "

# Window status format with explicit icons
set -g window-status-format "#[fg=#24273a,bg=#363a4f]#[fg=#cad3f5,bg=#363a4f] #I #[fg=#cad3f5,bg=#363a4f] #W #[fg=#363a4f,bg=#24273a]"
set -g window-status-current-format "#[fg=#24273a,bg=#8aadf4]#[fg=#24273a,bg=#8aadf4,bold] #I #[fg=#24273a,bg=#8aadf4,bold] #W #[fg=#8aadf4,bg=#24273a]"
set -g window-status-separator ""

# Pane borders
set -g pane-border-style "fg=#363a4f"
set -g pane-active-border-style "fg=#8aadf4"

# Message text
set -g message-style "bg=#8aadf4,fg=#24273a,bold"

# Pane number display
set -g display-panes-active-colour "#8aadf4"
set -g display-panes-colour "#363a4f"

# Clock
set -g clock-mode-colour "#8aadf4"

# =====================================
# ===           Plugins            ===
# =====================================

# List of plugins
set -g @plugin 'tmux-plugins/tpm'                  # Plugin manager
set -g @plugin 'tmux-plugins/tmux-sensible'        # Sensible defaults
set -g @plugin 'tmux-plugins/tmux-resurrect'       # Save/restore sessions
set -g @plugin 'tmux-plugins/tmux-continuum'       # Auto-save sessions
set -g @plugin 'tmux-plugins/tmux-yank'            # Better clipboard integration
set -g @plugin 'tmux-plugins/tmux-open'            # Open links from tmux
set -g @plugin 'tmux-plugins/tmux-battery'         # Battery status
set -g @plugin 'tmux-plugins/tmux-prefix-highlight' # Highlight when prefix is active
set -g @plugin 'tmux-plugins/tmux-sidebar'         # Directory tree sidebar
set -g @plugin 'tmux-plugins/tmux-copycat'         # Enhanced search
set -g @plugin 'christoomey/vim-tmux-navigator'    # Seamless vim/tmux navigation
set -g @plugin 'wfxr/tmux-fzf-url'                 # Open URLs with fzf
set -g @plugin 'sainnhe/tmux-fzf'                  # FZF integration
set -g @plugin 'fcsonline/tmux-thumbs'             # Quickly copy text with hints
set -g @plugin 'laktak/extrakto'                   # Extract text from pane

# =====================================
# ===        Plugin Settings        ===
# =====================================

# Prefix highlight settings
set -g @prefix_highlight_fg "#24273a"              # Foreground color
set -g @prefix_highlight_bg "#8aadf4"              # Background color
set -g @prefix_highlight_show_copy_mode 'on'       # Show when in copy mode
set -g @prefix_highlight_copy_mode_attr "fg=#24273a,bg=#eed49f,bold" # Copy mode style

# Resurrect settings
set -g @resurrect-capture-pane-contents 'on'       # Restore pane contents
set -g @resurrect-strategy-vim 'session'           # Restore vim sessions
set -g @resurrect-strategy-nvim 'session'          # Restore neovim sessions

# Continuum settings
set -g @continuum-restore 'on'                     # Auto-restore last saved session
set -g @continuum-save-interval '10'               # Save every 10 minutes

# Sidebar settings
set -g @sidebar-tree-command 'ls -1a'              # Command to show in sidebar
set -g @sidebar-tree-width '40'                    # Width of sidebar
set -g @sidebar-tree-position 'right'              # Position of sidebar

# Thumbs settings
set -g @thumbs-key F                               # Activate with prefix-F
set -g @thumbs-contrast 1                          # Contrast for hints

# Extrakto settings
set -g @extrakto_key 'tab'                         # Key to trigger extrakto
set -g @extrakto_split_size '15'                   # Split size

# FZF URL settings
set -g @fzf-url-bind 'u'                           # Trigger with prefix-u

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
